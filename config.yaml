# Vestig Configuration

# Display settings
display:
  show_version: true  # Set to false to suppress version output on startup

# Embedding configuration
embedding:
  model: "BAAI/bge-m3"
  dimension: 1024
  normalize: true

# Storage
storage:
  db_path: ./data/memory.db

# Retrieval
retrieval:
  default_limit: 5

# M2: Content hygiene (quality firewall)
hygiene:
  min_chars: 12
  max_chars: 4000
  normalize_whitespace: true
  reject_exact_duplicates: true
  near_duplicate:
    enabled: true
    threshold: 0.92

# Document ingestion (LLM-based memory extraction)
ingestion:
  model: claude-sonnet-4.5          # LLM for memory extraction
  chunk_size: 20000                 # Characters per chunk (≈5k tokens)
  chunk_overlap: 500                # Overlap for context continuity
  min_confidence: 0.6               # Minimum confidence threshold
  format: auto                      # auto|plain|claude-session
  force_entities: []                # Forced entities (TYPE:Name) on every memory
  claude_session:
    include_roles:
      - user
      - assistant
    include_message_types:
      - text
    drop_thinking: true
    drop_tool_use: true

# Prompt configuration
prompts:
  # Memory extraction prompt (from prompts.yaml)
  extract_memories: "extract_memories_from_session"

  # Summary generation prompt (from prompts.yaml)
  # Change to "summary_v2" or other versions to experiment
  summary: "summary_v1"

# M3: Time & Truth (TraceRank, temporal ranking)
m3:
  event_logging:
    enabled: true

  tracerank:
    enabled: true
    tau_days: 21          # Recency decay time constant (weeks)
    cooldown_hours: 24    # Anti-burst window (1 day)
    burst_discount: 0.2   # Weight for burst events (0-1)
    k: 0.35               # TraceRank boost strength

  retrieval:
    include_expired: false  # Show deprecated memories by default?

# M4: Graph Layer (entities, edges, traversal)
m4:
  entity_types:
    # Configurable entity types (not hardcoded)
    allowed_types:
      - PERSON      # People, developers, users
      - ORG         # Organizations, companies, teams
      - SYSTEM      # Software systems, services, applications
      - PROJECT     # Projects, repositories, codebases
      - PLACE       # Locations, servers, environments
      - SKILL       # Programming languages, methodologies, techniques
      - TOOL        # Tools, libraries, frameworks, packages
      - FILE        # Files, paths, configurations, documents
      - CONCEPT     # Abstract concepts, patterns, principles, ideas

  entity_extraction:
    enabled: true
    mode: llm              # "llm" or "heuristic"

    # LLM extraction settings
    llm:
      model: claude-sonnet-4.5  # Or from global config
      max_entities_per_memory: 10
      min_confidence: 0.75       # Only create edges above this threshold
      store_low_confidence: false  # Don't store edges below threshold
      max_evidence_length: 200   # Chars for evidence field

    # Optional heuristic cleanup (post-LLM)
    heuristics:
      strip_titles: true         # "Dr Alice" → "Alice"
      normalize_org_suffixes: true  # "Acme Ltd" → "Acme"
      reject_garbage: true       # All punctuation, too short
      split_lists: false         # "A, B and C" → separate entities (risky)

  edge_creation:
    mentions:
      enabled: true
      default_weight: 1.0
      confidence_gated: true     # Respect min_confidence from extraction

    related:
      enabled: true
      similarity_threshold: 0.6   # Conservative (high bar)
      max_edges_per_memory: 10    # Cap to prevent graph sprawl

  graph_expansion:
    enabled: true
    max_expand_via_entities: 3   # Limit 1-hop entity expansion
    max_expand_via_related: 3    # Limit 1-hop RELATED expansion
    include_expired: false       # Exclude expired edges by default
    min_confidence: 0.75         # Exclude low-confidence edges from expansion
