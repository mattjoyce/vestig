# Vestig Config - Standard Entity Ontology (New Format)
# Database: vestig-standard.db

# Embedding configuration
embedding:
  provider: "llm"
  model: "embeddinggemma:latest"
  dimension: 768
  normalize: true

# Storage
storage:
  db_path: "vestig-standard.db"

# Retrieval
retrieval:
  default_limit: 5

  # M5: Entity-based retrieval (hybrid semantic + entity matching)
  entity_path:
    enabled: true
    entity_weight: 0.5
    similarity_threshold: 0.7

# M2: Content hygiene (quality firewall)
hygiene:
  min_chars: 12
  max_chars: 4000
  normalize_whitespace: true
  reject_exact_duplicates: true
  near_duplicate:
    enabled: true
    threshold: 0.92
    skip_manual_source: true

# Document ingestion (LLM-based memory extraction)
ingestion:
  model: phi3:latest
  chunk_size: 4000
  chunk_overlap: 400
  min_confidence: 0.8
  format: auto
  force_entities: []

  # Two-pass extraction: separate memory and entity extraction
  two_pass_extraction:
    enabled: true
    memory_prompt: "extract_memories_simple"
    entity_prompt: "extract_entities"
    batch_entity_extraction: true
    batch_size: 50

  # JSON parsing retry logic
  retry:
    max_attempts: 3
    backoff_seconds: 1.0

  # Rate limiting
  rate_limits:
    requests_per_minute: 30
    tokens_per_minute: 60000

  claude_session:
    include_roles:
      - user
      - assistant
    include_message_types:
      - text
    drop_thinking: true
    drop_tool_use: true

# Prompt configuration
prompts:
  extract_memories: "extract_memories_v4"
  summary: "summary_v2"

# M3: Time & Truth (TraceRank, temporal ranking)
m3:
  event_logging:
    enabled: true

  tracerank:
    enabled: true
    tau_days: 21
    cooldown_hours: 24
    burst_discount: 0.2
    k: 0.35
    graph_connectivity_enabled: false
    graph_k: 0.0

  retrieval:
    include_expired: false

# M4: Graph Layer - Standard Entity Types (New Ontology Format)
m4:
  entity_types:
    ontology:
      - name: "PERSON"
        description: "Named individuals"
        tier: 1
        synonyms: ["individual"]
        examples: ["Matt Joyce", "Dr. Smith", "Anthony Waddle"]

      - name: "ORG"
        description: "Organizations, companies, institutions"
        tier: 1
        synonyms: ["organization", "company", "institution", "vendor"]
        examples: ["Calvary Health Care", "Macquarie University", "Heidi Health"]

      - name: "SYSTEM"
        description: "Named software/hardware platforms, technical infrastructure"
        tier: 1
        synonyms: ["platform", "infrastructure"]
        examples: ["AudioMoth", "Veeam", "Unraid", "Claude Sonnet 4.5"]

      - name: "PROJECT"
        description: "Named initiatives, programs, research efforts"
        tier: 1
        synonyms: ["initiative", "program"]
        examples: ["Project Bronte", "BiophonyAI", "Vestig", "AI Adoption Survey"]

      - name: "TOOL"
        description: "Specific software, hardware, instruments, applications"
        tier: 2
        synonyms: ["application", "instrument", "software"]
        examples: ["Docker", "Obsidian", "Zoom 3DVR", "MPPT solar charging module"]

      - name: "PLACE"
        description: "Specific locations, sites, facilities, geographic entities"
        tier: 2
        synonyms: ["location", "site", "facility"]
        examples: ["Enfield Intermodal", "NSW", "Bay Ridge"]

      - name: "SKILL"
        description: "Specialized capabilities, methodologies, technical approaches"
        tier: 2
        synonyms: ["capability", "methodology", "technique"]
        examples: ["acoustic monitoring", "GPU-accelerated spectrogram generation", "M&A due diligence"]

      - name: "FILE"
        description: "Named documents, artifacts, repositories with specific identifiers"
        tier: 2
        synonyms: ["document", "artifact", "repository"]
        examples: ["prompts.yaml", "SKILL.md", "SOW Number: 2", "Q3 Report"]

      - name: "CONCEPT"
        description: "Domain-specific compound terms representing specialized knowledge"
        tier: 3
        synonyms: ["specialized term", "domain concept"]
        examples: ["ambient voice AI", "AI governance framework", "clinical AI scribe", "therapeutic robotics"]

  entity_extraction:
    enabled: true
    mode: llm

    llm:
      model: claude-haiku-4.5
      max_entities_per_memory: 10
      min_confidence: 0.80
      store_low_confidence: false
      max_evidence_length: 200

      rate_limits:
        requests_per_minute: 30
        tokens_per_minute: 60000

    heuristics:
      strip_titles: true
      normalize_org_suffixes: true
      reject_garbage: true
      split_lists: false

  edge_creation:
    mentions:
      enabled: true
      default_weight: 1.0
      confidence_gated: true

    related:
      enabled: true
      similarity_threshold: 0.7
      max_edges_per_memory: 10

  graph_expansion:
    enabled: true
    max_expand_via_entities: 3
    max_expand_via_related: 3
    include_expired: false
    min_confidence: 0.75
