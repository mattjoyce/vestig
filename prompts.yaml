# Vestig LLM Prompts
# Use {{token}} for variable substitution

# M4: Entity Extraction (LLM-based)
extract_entities: |
  Extract entities from the following memory content.

  Allowed entity types: {{allowed_types}}

  Rules:
  1. Only extract entities that clearly appear in the text
  2. Assign a confidence score (0.0-1.0) based on how certain you are
  3. Provide brief evidence (max 200 chars) explaining why this is an entity
  4. Prefer full names over partial mentions
  5. Entity types: PERSON, ORG, SYSTEM, PROJECT, PLACE, SKILL, TOOL, FILE, CONCEPT

  Memory content:
  {{content}}

  Output ONLY valid JSON in this exact format:
  {
    "entities": [
      {
        "name": "exact name as it appears or normalized form",
        "type": "PERSON|ORG|SYSTEM|PROJECT|PLACE|SKILL|TOOL|FILE|CONCEPT",
        "confidence": 0.0-1.0,
        "evidence": "short explanation"
      }
    ]
  }

  If no entities found, return: {"entities": []}

# Session Ingestion: Extract memories from conversation transcripts
extract_memories_from_session: |
  Extract discrete, factual memories from this conversation transcript, along with entities mentioned in each memory.

  GUIDELINES FOR MEMORIES:
  - One clear fact, decision, insight, or knowledge point per memory
  - Self-contained with sufficient context for standalone understanding
  - Substantive content only: technical details, decisions, learnings
  - Skip greetings, small talk, procedural exchanges
  - Preserve key context (who, what, when relevant)
  - Confidence reflects clarity and factuality

  GUIDELINES FOR ENTITIES:
  - Extract entities mentioned in each memory
  - Entity types: PERSON, ORG, SYSTEM, PROJECT, PLACE, SKILL, TOOL, FILE, CONCEPT
  - Only extract entities that are clearly mentioned in the memory
  - Provide text evidence supporting each entity
  - Confidence reflects certainty this is the correct entity type

  CONVERSATION CHUNK:
  {{content}}

  OUTPUT (valid JSON only):
  {
    "memories": [
      {
        "content": "self-contained memory with context",
        "confidence": 0.0-1.0,
        "rationale": "why this matters",
        "entities": [
          {
            "name": "entity name",
            "type": "PERSON|ORG|SYSTEM|PROJECT|PLACE|SKILL|TOOL|FILE|CONCEPT",
            "confidence": 0.0-1.0,
            "evidence": "text snippet supporting this entity"
          }
        ]
      }
    ]
  }

  Return {"memories": []} if none found.
